<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="erah">
<title>eRah Manual • erah</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="eRah Manual">
<meta property="og:description" content="erah">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">erah</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/erah-manual.html">eRah Manual</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/xdomingoal/erah-devel/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>eRah Manual</h1>
            <h3 data-toc-skip class="subtitle">v2.0.0</h3>
                        <h4 data-toc-skip class="author">Xavier
Domingo–Almenara</h4>
            
            <h4 data-toc-skip class="date">02 December, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/xdomingoal/erah-devel/blob/HEAD/vignettes/erah-manual.Rmd" class="external-link"><code>vignettes/erah-manual.Rmd</code></a></small>
      <div class="d-none name"><code>erah-manual.Rmd</code></div>
    </div>

    
    
<p>This vignette presents <strong>eRah</strong>, an R package with an
integrated design that allows for an innovative deconvolution of GC–MS
chromatograms using multivariate techniques based on blind source
separation (BSS), alignment of spectra across samples, and automatic
identification of metabolites by spectral library matching.
<strong>eRah</strong> outputs a table with compound names, matching
scores and the area of the compound for each sample.
<strong>eRah</strong> is designed in an open-structure, where
researchers can integrate different algorithms for each step of the
pipeline, i.e., compound deconvolution, alignment, identification or
statistical analysis. <strong>eRah</strong> has been tested with
GC-TOF/MS and GC-qTOF/MS (using nominal mass) equipment, and is
compatible with different spectral databases.</p>
<p>Here, we integrate the downloadable version of the MassBank spectral
library for an straightforward identification. If you use the package
eRah in your analysis and publications please cite <span class="citation">Domingo-Almenara et al. (2015)</span> and <span class="citation">Domingo-Almenara et al. (2016)</span>. <span class="citation">Domingo-Almenara et al. (2016)</span> is also referred
for a more technical and detailed explanation about the eRah
methods.</p>
<div class="section level4">
<h4 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p><strong>eRah</strong> can be installed from any <strong>CRAN</strong>
repository, by:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'erah'</span><span class="op">)</span></span></code></pre></div>
<p>Or from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'xdomingoal/erah-devel'</span><span class="op">)</span></span></code></pre></div>
<p>Then loaded using:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://metsyslab.com/" class="external-link">erah</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       _____        _</span></span>
<span><span class="co">##      |  __ \      | |        eRah R package:</span></span>
<span><span class="co">##   ___| |__) | __ _| |__       ----------------</span></span>
<span><span class="co">##  / _ \  _   // _` |  _ \     Untargeted GC-MS metabolomics profiling</span></span>
<span><span class="co">## |  __/ |  \ \ (_| | | | |</span></span>
<span><span class="co">##  \___|_|   \_\__,_|_| |_|    Version 2.0.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - Type 'citation('erah')' for citing this R package in publications.</span></span>
<span><span class="co">##  - Type 'vignette('eRahManual', package='erah')' for a tutorial on eRah's usage.</span></span>
<span><span class="co">##  - For bugs, problems and issues, please do not hesitate in contacting xavier.domingoa@eurecat.org or opening an issue on the Github repository (https://github.com/xdomingoal/erah-devel/issues).</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="support">Support<a class="anchor" aria-label="anchor" href="#support"></a>
</h4>
<p>Any enquiries, bug reports or suggestions are welcome and they should
be addressed to <a href="mailto:xavier.domingoa@eurecat.org" class="email">xavier.domingoa@eurecat.org</a>. Alternatively, please
file an issue (and, if possible, a reproducible example) at <a href="https://github.com/xdomingoal/erah-devel/issues" class="external-link uri">https://github.com/xdomingoal/erah-devel/issues</a>.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><strong>eRah</strong> automatically detects and deconvolves the
spectra of the compounds appearing in GC–MS chromatograms.
<strong>eRah</strong> processes the raw data files (netCDF or mzXML) of
a complete metabolomics experiment in an automated manner.</p>
<p>After that, compounds are aligned by spectral similarity and
retention time distance. <strong>eRah</strong> computes the Euclidean
distance between retention time distance and spectral similarity for all
compounds in the chromatograms, resulting in compounds appearing across
the maximum number of samples and with the least retention time and
spectral distance.</p>
<p>Also, an (optional) missing compound recovery step, can be applied to
recover those compounds that are missing in some samples. Missing
compounds appear as a result of an incorrect deconvolution or alignment
- due to a low compound concentration in a sample - , or because it is
not present in the sample. This forces the final data table with
compound names and compounds area, to not have any missing (zero)
values.</p>
<p>Finally, identification of the found metabolites is conducted. A mean
spectra from each group of aligned compounds is compared with a
reference library. <strong>eRah</strong> includes a custom version of
MassBank repository. Other libraries can imported with eRah (e.g., Golm
Metabolome Database), and eRah’s deconvolved spectra can be exported for
further comparison with NIST library.</p>
</div>
<div class="section level2">
<h2 id="gcms-data-processing-with-erah-a-tutorial">GC–MS Data Processing with eRah: a tutorial<a class="anchor" aria-label="anchor" href="#gcms-data-processing-with-erah-a-tutorial"></a>
</h2>
<p>In this section we show the processing of example samples from a
spike-in experiment designed for interrogating data processing methods
from the <strong><a href="http://bioconductor.org/packages/release/data/experiment/html/gcspikelite.html" class="external-link">gcspikelite</a></strong>
data package <span class="citation">(Robinson 2018)</span> that were
analyzed using GC–MS. This sample set consists of nine samples with
three triplicate classes.</p>
<p>The <strong>gcspikelite</strong> package can be installed from
bioconductor using the <strong>BiocManager</strong> package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'BiocManager'</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">'gcspikelite'</span><span class="op">)</span></span></code></pre></div>
<p>The package and necessary data can be loaded using:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gcspikelite</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"targets"</span><span class="op">)</span></span></code></pre></div>
<p>This tutorial shows how to deconvolve, align and identify the
compounds contained in these samples. All the listed commands (script)
to reproduce the following demo can by found by executing:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://metsyslab.com/" class="external-link">erah</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"erah"</span><span class="op">)</span></span></code></pre></div>
<p>and then click on User guides, package vignettes and other
documentation and on source from the ’eRah Manual’.</p>
<div class="section level3">
<h3 id="creating-a-new-experiment">Creating a new experiment<a class="anchor" aria-label="anchor" href="#creating-a-new-experiment"></a>
</h3>
<p>Prior to deconvolution, alignment and compound identification, we
first need to setup a new experiment where the sample meta information
is defined, such as file paths and class types. <strong>eRah</strong>
provides two ways in which this can be achieved. The first of which
requires only sample file paths and further sample class information is
then added manually. The second derives sample class information and
file paths from the underlying directory structure of a given experiment
directory path.</p>
<div class="section level4">
<h4 id="using-file-paths-only">Using file paths only<a class="anchor" aria-label="anchor" href="#using-file-paths-only"></a>
</h4>
<p>Using this input method we first load the file paths of the given
data set. For our example data set from the <strong>gcspikelite</strong>
package we can do this by:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'data'</span>,package <span class="op">=</span> <span class="st">'gcspikelite'</span><span class="op">)</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="va">files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">files</span>,<span class="va">grepl</span>,pattern <span class="op">=</span> <span class="st">'CDF'</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p><code>files</code> then contains a vector of file paths to the nine
.CDF files needed for processing. An instrumental information table can
then be created from these using the following:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">instrumental</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createInstrumentalTable.html">createInstrumentalTable</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span></code></pre></div>
<p>Further columns containing additional sample instrumental information
can also be added to this table.</p>
<p>Next we can optionally define our class or phenotype information for
our sample set. This can be done using the following, providing a vector
of classes names that are associated with each file. <strong>Ensure that
the order of the class affiliations match those of your file
paths.</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">targets</span><span class="op">$</span><span class="va">Group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">targets</span><span class="op">$</span><span class="va">FileName</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">phenotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createPhenoTable.html">createPhenoTable</a></span><span class="op">(</span><span class="va">files</span>, cls <span class="op">=</span> <span class="va">classes</span><span class="op">)</span></span></code></pre></div>
<p>Similarly to the <code>instrumental</code> table, columns containing
additional sample instrumental information can also be added.</p>
<p>A new experiment can then be setup using our
<code>instrumental</code> and <code>phenotype</code> tables by:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newExp.html">newExp</a></span><span class="op">(</span>instrumental <span class="op">=</span> <span class="va">instrumental</span>,</span>
<span>             phenotype <span class="op">=</span> <span class="va">phenotype</span>, </span>
<span>             info <span class="op">=</span> <span class="st">"DEMO Experiment"</span><span class="op">)</span></span></code></pre></div>
<p>Where an experiment name can be defined using the <code>info</code>
argument. This creates a new <code>MetaboSet</code> object used for
storing the sample metadata and processing results.</p>
</div>
<div class="section level4">
<h4 id="using-file-directory-structure">Using file directory structure<a class="anchor" aria-label="anchor" href="#using-file-directory-structure"></a>
</h4>
<p>Alternatively, the structure of an experiment directory can be used
to define the instrument and class information. The experiment directory
should be organized as follows: all the samples related to each class
have to be stored in the same folder (one folder = one class), and all
the class-folders in one folder, which is the experiment folder (Figure
1). eRah also accepts only one class; in that case, only one
class-folder has to be created inside an experiment-folder.</p>
<p>Figure 1 below shows the structure of an example experiment folder
name PCOS. This contains two class-folders called ’CONTROL’ and
’DISEASE’, which each contain the sample files for that class. In this
case these are the CON BASA 567795.mzXML, and CON BASA 574488.mzXML
files in the CONTROL class.</p>
<div class="figure" style="text-align: center">
<img src="figures/classFolders.png" alt="**Figure 1:** An example distribution of the raw data files and the class and experiment folders."><p class="caption">
<strong>Figure 1:</strong> An example distribution of the raw data files
and the class and experiment folders.
</p>
</div>
<p>To create a new experiment we have to create first a .csv type file
containing the name of the raw data files to process. The raw data files
have to be in the same directory as the instrumental file.
<strong>eRah</strong> also admits a phenotypic table which contains the
classes of the samples. The instrumental data file is always needed but
the phenotype file is optional. The instrumental table can have as many
columns as desired, but it has to contain at least two columns named
’sampleID’ and ’filename’. The same is applicable to the phenotypic
table, in this case the two necessary columns are ’sampleID’ and
’class’. Please note that capital letters of the column names must be
respected and that ’sampleID’ is the column that relates the
instrumental and phenotypic tables. These files can also be created
automatically, execute the following command:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/createdt.html">createdt</a></span><span class="op">(</span><span class="st">'experiment_path/PCOS/'</span><span class="op">)</span></span></code></pre></div>
<p>Where <code>experiment_path</code> is the path where the
experiment-folder is, and PCOS is the experiment-folder. Two things have
to be considered at this step: .csv files are different when created by
American and European computers, so errors may raise due to that fact.
Also, the folder containing the samples (in this case, the folder
’PCOS’, must contain only folders. If the folder ’PCOS’ contains files
(for example, already created .csv files), eRah will prompt an
error.</p>
<ul>
<li>Note that if you have an specific question about a function, you can
always access to the help of the function with a question mark before
the name of the function: <code><a href="../reference/createdt.html">?createdt</a></code>
</li>
</ul>
<p>The new experiment can then be created by loading the instrumental
and phenotypic tables into the workspace and supplying these to
<code><a href="../reference/newExp.html">newExp()</a></code> as below:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">instrumental</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">'experiment_path/PCOS/PCOS_inst.csv'</span><span class="op">)</span></span>
<span><span class="va">phenotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">'experiment_path/PCOS/PCOS_pheno.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newExp.html">newExp</a></span><span class="op">(</span>instrumental <span class="op">=</span> <span class="va">instrumental</span>,</span>
<span>             phenotype <span class="op">=</span> <span class="va">phenotype</span>,</span>
<span>             info <span class="op">=</span> <span class="st">'PCOS Experiment'</span><span class="op">)</span></span></code></pre></div>
<p>This creates a new <code>MetaboSet</code> object used for storing the
sample metadata and processing results.</p>
</div>
<div class="section level4">
<h4 id="accessing-sample-metadata">Accessing sample metadata<a class="anchor" aria-label="anchor" href="#accessing-sample-metadata"></a>
</h4>
<p>With <code><a href="../reference/metaData.html">metaData()</a></code>, <code><a href="../reference/phenoData.html">phenoData()</a></code> and
<code><a href="../reference/expClasses.html">expClasses()</a></code> we can retrieve the instrumental data and the
experiment classes and the processing status:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/metaData.html">metaData</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 4</span></span></span>
<span><span class="co">##   sampleID filename                                                  date  time </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 0709_468 /home/runner/work/_temp/Library/gcspikelite/data/0709_46… 2023… 15:0…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 0709_470 /home/runner/work/_temp/Library/gcspikelite/data/0709_47… 2023… 15:0…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 0709_471 /home/runner/work/_temp/Library/gcspikelite/data/0709_47… 2023… 15:0…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 0709_474 /home/runner/work/_temp/Library/gcspikelite/data/0709_47… 2023… 15:0…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 0709_475 /home/runner/work/_temp/Library/gcspikelite/data/0709_47… 2023… 15:0…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 0709_479 /home/runner/work/_temp/Library/gcspikelite/data/0709_47… 2023… 15:0…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> 0709_485 /home/runner/work/_temp/Library/gcspikelite/data/0709_48… 2023… 15:0…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> 0709_493 /home/runner/work/_temp/Library/gcspikelite/data/0709_49… 2023… 15:0…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> 0709_496 /home/runner/work/_temp/Library/gcspikelite/data/0709_49… 2023… 15:0…</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/phenoData.html">phenoData</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 2</span></span></span>
<span><span class="co">##   sampleID class</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 0709_468 mmA  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 0709_470 mmD  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 0709_471 mmD  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 0709_474 mmA  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 0709_475 mmA  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 0709_479 mmD  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> 0709_485 mmC  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> 0709_493 mmC  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> 0709_496 mmC</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/expClasses.html">expClasses</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Experiment containing 9 samples in 3 different type of classes named: mmA, mmC, mmD. </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">##   Sample ID Class Type Processing Status</span></span>
<span><span class="co">## 1  0709_468        mmA     Not processed</span></span>
<span><span class="co">## 2  0709_470        mmD     Not processed</span></span>
<span><span class="co">## 3  0709_471        mmD     Not processed</span></span>
<span><span class="co">## 4  0709_474        mmA     Not processed</span></span>
<span><span class="co">## 5  0709_475        mmA     Not processed</span></span>
<span><span class="co">## 6  0709_479        mmD     Not processed</span></span>
<span><span class="co">## 7  0709_485        mmC     Not processed</span></span>
<span><span class="co">## 8  0709_493        mmC     Not processed</span></span>
<span><span class="co">## 9  0709_496        mmC     Not processed</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="compound-deconvolution">Compound deconvolution<a class="anchor" aria-label="anchor" href="#compound-deconvolution"></a>
</h3>
<p>The compounds in data are deconvolved using
<code><a href="../reference/deconvolveComp.html">deconvolveComp()</a></code>. This function requires a
<code>Deconvolution parameters</code> object, that can be created with
<code>setDecPar</code> function, containing the parameters of the
algorithm as shown as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex.dec.par</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setDecPar.html">setDecPar</a></span><span class="op">(</span>min.peak.width <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        avoid.processing.mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span><span class="op">:</span><span class="fl">69</span>,<span class="fl">73</span><span class="op">:</span><span class="fl">75</span>,<span class="fl">147</span><span class="op">:</span><span class="fl">149</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The peak width value (in seconds) is a critical parameter that
conditions the efficiency of eRah, and also the masses to exclude have
an important role in GC–MS-based metabolomics experiments.</p>
<ul>
<li><p><strong>Peak width parameter:</strong> typically, this value
should be the less than half of the mean compound width. For this
experiment, the average peak width is between 2 and 2.5 seconds, so we
selected 1 second peak width. The lower this parameter is set to, the
more sensibility to deconvolve co-eluted compounds, but it also may
increase the number of false positive compounds. If is set too low the
algorithm will generate too false positives compounds, which this
usually means that one single compound will be detected twice. If the
parameter value is increased, the algorithm may fail in separate
co-eluted compounds, leading to generate less false positives but
loosing capacity of detection.</p></li>
<li><p><strong>Masses to exclude:</strong> masses m/z 73, 74, 75, 147,
148, 149 are recommended to be excluded in the processing and subsequent
steps, since these are ubiquitous mass fragments typically generated
from compounds carrying a trimethylsilyl moiety. If the samples have
been derivatized, including these masses will only hamper the
deconvolution process; this is because an important number of compounds
will share these masses leading to a poorer selectivity between
compounds. Also, in complex GC–MS-based metabolomics samples, we also
recommend excluding all masses from 1 to 69 Da, for the same reasons.
Those masses are generated from compounds with groups that are very
common for a large number of compounds in metabolomics, leading to a
poorer selectivity between compounds. Although those masses are also the
most intense m/z in the compounds spectra, eRah will automatically set
the used library’s masses to zero, so it does not affect spectral
matching and identification.</p></li>
</ul>
<p><strong>eRah</strong> also supports parallel processing at this step
using the <a href="https://CRAN.R-project.org/package=future" class="external-link">future</a>
package. This enables the faster processing of large sample sets.</p>
<p>By default, deconvolution will be done on each file sequentially.
However, parallel processing can be activated prior to to this by
specifying a parallel backend using <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan()</a></code>. The following
example specifies using the <code>multisession</code> backend (muliple
background R sessions) with two worker processes.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span>,workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>See the future package <a href="https://CRAN.R-project.org/package=future" class="external-link">documentation</a> for
more information on the types of parallel backends that are
available.</p>
<p>The samples can then be deconvolved using:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deconvolveComp.html">deconvolveComp</a></span><span class="op">(</span><span class="va">ex</span>, <span class="va">ex.dec.par</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_468.CDF ... Processing 1 / 9</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_470.CDF ... Processing 2 / 9</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_471.CDF ... Processing 3 / 9</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_474.CDF ... Processing 4 / 9</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_475.CDF ... Processing 5 / 9</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_479.CDF ... Processing 6 / 9</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_485.CDF ... Processing 7 / 9</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_493.CDF ... Processing 8 / 9</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Deconvolving compounds from /home/runner/work/_temp/Library/gcspikelite/data/0709_496.CDF ... Processing 9 / 9</span></span></code></pre>
<pre><code><span><span class="co">## Compounds deconvolved</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span></span></code></pre></div>
<pre><code><span><span class="co">## A "MetaboSet" object containing 9 samples </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Data processed with </span></span>
<span><span class="co">## Info attached to this experiment: </span></span>
<span><span class="co">##  DEMO Experiment</span></span></code></pre>
<p>Data can be saved and loaded at any stage of the process by:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">ex</span>, file <span class="op">=</span> <span class="st">"testPCOS.rda"</span><span class="op">)</span></span>
<span><span class="co"># Load</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"testPCOS.rda"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="alignment">Alignment<a class="anchor" aria-label="anchor" href="#alignment"></a>
</h3>
<p>Alignment is executed with <code><a href="../reference/alignComp.html">alignComp()</a></code>. The parameters
also have to be set prior to this.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex.al.par</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setAlPar.html">setAlPar</a></span><span class="op">(</span>min.spectra.cor <span class="op">=</span> <span class="fl">0.90</span>, max.time.dist <span class="op">=</span> <span class="fl">3</span>, mz.range <span class="op">=</span> <span class="fl">70</span><span class="op">:</span><span class="fl">600</span><span class="op">)</span></span></code></pre></div>
<p>The parameters are <code>min.spectra.cor</code>,
<code>max.time.dist</code> and <code>mz.range</code>. The
<code>min.spectra.cor</code> (Minimum spectral correlation) value - from
0 (non similar) to 1 (very similar) - sets how similar two or more
compounds have be to be considered for alignment between them. We can be
restrictive with this parameter, as if one compound is not detected in
some samples, we can retrieve it later by the ’missing compound
recovery’ step. Also, we impose a maximum disalignment distance of 3
seconds (<code>max.time.dist</code>). This value (in seconds) sets how
far two or more compounds can be considered for alignment between them.
<code>mz.range</code> is the range of masses that is considered when
comparing spectra. We set that only the masses from 70 to 600 are taken
into account, for the reasons commented above in the ’Masses to exclude’
point.</p>
<p>Alignment can be performed by:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/alignComp.html">alignComp</a></span><span class="op">(</span><span class="va">ex</span>, alParameters <span class="op">=</span> <span class="va">ex.al.par</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex</span></span></code></pre></div>
<pre><code><span><span class="co">## A "MetaboSet" object containing 9 samples </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Data processed with </span></span>
<span><span class="co">## Info attached to this experiment: </span></span>
<span><span class="co">##  DEMO Experiment</span></span></code></pre>
<ul>
<li>
<strong>Aligning large ammout of samples:</strong> For experiments
containing more than 100 (Windows) or 1000 (Mac or Linux) samples,
alignment could lead to errors or show a poor run-time performance. In
those cases alignment can be conducted by block segmentation. For more
details about <code><a href="../reference/alignComp.html">alignComp()</a></code> access help using
<code><a href="../reference/alignComp.html">?alignComp</a></code>
</li>
</ul>
<p>We can decide to execute the missing compound recovery step (and
retrieve the compounds that have missing values - have not been found -
in certain samples) or also identify the compounds without applying
<code><a href="../reference/recMissComp.html">recMissComp()</a></code>. In other words, the missing compound
recovery step is optional. Here, we apply the missing recovery step to
later identify the compounds.</p>
</div>
<div class="section level3">
<h3 id="missing-compound-recovery">Missing compound recovery<a class="anchor" aria-label="anchor" href="#missing-compound-recovery"></a>
</h3>
<p>The missing compound recovery step only requires to indicate the
number of minimum values for which a compound wants to be ’re-searched’
in the samples. If a compound appears in at least the same or more
samples than the minimum samples value (<code>min.samples</code>), then,
this compound is searched in the rest of the samples where its
concentration has not been registered. To do so:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recMissComp.html">recMissComp</a></span><span class="op">(</span><span class="va">ex</span>, min.samples <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Updating alignment table... </span></span>
<span><span class="co">## Model fitted!</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span></span></code></pre></div>
<pre><code><span><span class="co">## A "MetaboSet" object containing 9 samples </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Data processed with </span></span>
<span><span class="co">## Info attached to this experiment: </span></span>
<span><span class="co">##  DEMO Experiment</span></span></code></pre>
<ul>
<li>
<strong>Missing compound recovery:</strong> The min.samples
parameter sets the number of samples from the total number of samples.
Also, this parameter should be large, in alignment with the dimension of
the number of samples in the experiment. If set too low, a higher number
of false positives are expected. A recommended strategy is to first
evaluate the average number of samples where the compounds appear, by
executeing <code><a href="../reference/alignList.html">alignList ()</a></code> or <code><a href="../reference/idList.html">idList()</a></code> - after
being identified - functions (explained in the following sections).
<strong>Warning:</strong> if we have already identified the compounds,
we always have to re-identify the compounds after executing the missing
compound recovery step, by<code><a href="../reference/identifyComp.html">identifyComp()</a></code>, as explained in
the following sections.</li>
</ul>
</div>
<div class="section level3">
<h3 id="identification">Identification<a class="anchor" aria-label="anchor" href="#identification"></a>
</h3>
<p>The final processing step is to identify the previously aligned
compounds and assign them a putative name. <strong>eRah</strong>
compares all the spectra found against a reference database. This
package includes a custom version of the MassBank MS library, which is
selected as default database for all the functions. However, we strongly
encourage the use of the Golm Metabolome Database (GMD). GMD importation
is described in following sections.</p>
<p>Identification can be executed by identifyComp, and accessed by
idList as follows:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identifyComp.html">identifyComp</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Constructing matrix database... </span></span>
<span><span class="co">## Comparing spectra... </span></span>
<span><span class="co">## Done!</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/idList.html">idList</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">id.list</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">##   AlignID tmean FoundIn Name.1                             </span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>      13  5.79       9 Harmaline (1TMS)                   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>      17  5.88       9 2-Hydroxypyridine                  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>      16  5.96       9 2-Hydroxypyridine                  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>      25  6.08       9 2'-Deoxyadenosine (3TMS)           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>      27  6.18       9 2,3-Bisphospho-glycerate           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>      35  6.36       9 DL-2,3-Diaminopropionic acid (2TMS)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>      39  6.50       9 (R)-(-)-Phenylephrine (2TMS)       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>      44  6.63       9 Malonic acid (2TMS)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="results-and-visualization">Results and visualization<a class="anchor" aria-label="anchor" href="#results-and-visualization"></a>
</h3>
<p>The identification list can be obtained using:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idList.html">idList</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 124 × 18</span></span></span>
<span><span class="co">##    AlignID tmean FoundIn Name.1     MatchFactor.1 DB.Id.1 CAS.1 Formula.1 Name.2</span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>      13  5.79       9 Harmaline… 88.58         <span style="color: #949494;">"</span>434<span style="color: #949494;">"</span>   6027… <span style="color: #949494;">"</span>C16H22N… Dopam…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>      17  5.88       9 2-Hydroxy… 87.89         <span style="color: #949494;">"</span> 25<span style="color: #949494;">"</span>   142-… <span style="color: #949494;">""</span>        4-Hyd…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>      16  5.96       9 2-Hydroxy… 99.27         <span style="color: #949494;">"</span> 25<span style="color: #949494;">"</span>   142-… <span style="color: #949494;">""</span>        4-Hyd…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>      25  6.08       9 2'-Deoxya… 59.47         <span style="color: #949494;">"</span>372<span style="color: #949494;">"</span>   1637… <span style="color: #949494;">"</span>C22H45N… 2'-De…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>      27  6.18       9 2,3-Bisph… 75.78         <span style="color: #949494;">"</span>456<span style="color: #949494;">"</span>   1443… <span style="color: #949494;">""</span>        DL-Ho…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>      35  6.36       9 DL-2,3-Di… 94.62         <span style="color: #949494;">"</span>334<span style="color: #949494;">"</span>   5487… <span style="color: #949494;">"</span>C18H48N… Oxami…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>      39  6.50       9 (R)-(-)-P… 94.10         <span style="color: #949494;">"</span>322<span style="color: #949494;">"</span>   61-7… <span style="color: #949494;">"</span>C18H37N… (-)-E…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>      44  6.63       9 Malonic a… 52.87         <span style="color: #949494;">"</span>252<span style="color: #949494;">"</span>   141-… <span style="color: #949494;">"</span>C13H28O… Dihyd…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>      45  6.66       9 L-Alanine… 99.11         <span style="color: #949494;">"</span>335<span style="color: #949494;">"</span>   56-4… <span style="color: #949494;">"</span>C12H31N… (R)-(…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>      51  6.75       9 L-Alanine… 99.15         <span style="color: #949494;">"</span>335<span style="color: #949494;">"</span>   56-4… <span style="color: #949494;">"</span>C12H31N… (R)-(…</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 114 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 9 more variables: MatchFactor.2 &lt;chr&gt;, DB.Id.2 &lt;chr&gt;, CAS.2 &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Formula.2 &lt;chr&gt;, Name.3 &lt;chr&gt;, MatchFactor.3 &lt;chr&gt;, DB.Id.3 &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   CAS.3 &lt;chr&gt;, Formula.3 &lt;chr&gt;</span></span></span></code></pre>
<p>The alignment list can be returned using:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/alignList.html">alignList</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 124 × 13</span></span></span>
<span><span class="co">##    AlignID Factor     tmean FoundIn `0709_468` `0709_470` `0709_471` `0709_474`</span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>      13 Factor #13  5.79       9     <span style="text-decoration: underline;">46</span>805      <span style="text-decoration: underline;">43</span>277       <span style="text-decoration: underline;">49</span>578      <span style="text-decoration: underline;">40</span>353</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>      17 Factor #17  5.88       9    <span style="text-decoration: underline;">153</span>248.    <span style="text-decoration: underline;">197</span>488.     <span style="text-decoration: underline;">102</span>053     <span style="text-decoration: underline;">105</span>891</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>      16 Factor #16  5.96       9    <span style="text-decoration: underline;">427</span>706     <span style="text-decoration: underline;">533</span>857      <span style="text-decoration: underline;">525</span>813     <span style="text-decoration: underline;">588</span>514</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>      25 Factor #25  6.08       9     <span style="text-decoration: underline;">69</span>133      <span style="text-decoration: underline;">94</span>935       <span style="text-decoration: underline;">93</span>110      <span style="text-decoration: underline;">90</span>711</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>      27 Factor #27  6.18       9    <span style="text-decoration: underline;">406</span>890     <span style="text-decoration: underline;">624</span>249.     <span style="text-decoration: underline;">484</span>318     <span style="text-decoration: underline;">456</span>469</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>      35 Factor #35  6.36       9     <span style="text-decoration: underline;">33</span>943      <span style="text-decoration: underline;">47</span>453       <span style="text-decoration: underline;">44</span>354      <span style="text-decoration: underline;">34</span>835</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>      39 Factor #39  6.50       9     <span style="text-decoration: underline;">26</span>594      <span style="text-decoration: underline;">35</span>572       <span style="text-decoration: underline;">37</span>724      <span style="text-decoration: underline;">29</span>419</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>      44 Factor #44  6.63       9   4<span style="text-decoration: underline;">549</span>988    4<span style="text-decoration: underline;">743</span>601     4<span style="text-decoration: underline;">642</span>613    5<span style="text-decoration: underline;">242</span>164</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>      45 Factor #45  6.66       9   3<span style="text-decoration: underline;">022</span>490    1<span style="text-decoration: underline;">620</span>110     1<span style="text-decoration: underline;">544</span>762    1<span style="text-decoration: underline;">223</span>930</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>      51 Factor #51  6.75       9    <span style="text-decoration: underline;">818</span>746     <span style="text-decoration: underline;">942</span>865      <span style="text-decoration: underline;">923</span>088     <span style="text-decoration: underline;">811</span>215</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 114 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: `0709_475` &lt;dbl&gt;, `0709_479` &lt;dbl&gt;, `0709_485` &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `0709_493` &lt;dbl&gt;, `0709_496` &lt;dbl&gt;</span></span></span></code></pre>
<p>And the final data list can be returned using:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dataList.html">dataList</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 124 × 27</span></span></span>
<span><span class="co">##    AlignID tmean FoundIn Name.1     MatchFactor.1 DB.Id.1 CAS.1 Formula.1 Name.2</span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>      13  5.79       9 Harmaline… 88.58         <span style="color: #949494;">"</span>434<span style="color: #949494;">"</span>   6027… <span style="color: #949494;">"</span>C16H22N… Dopam…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>      16  5.96       9 2-Hydroxy… 99.27         <span style="color: #949494;">"</span> 25<span style="color: #949494;">"</span>   142-… <span style="color: #949494;">""</span>        4-Hyd…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>      17  5.88       9 2-Hydroxy… 87.89         <span style="color: #949494;">"</span> 25<span style="color: #949494;">"</span>   142-… <span style="color: #949494;">""</span>        4-Hyd…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>      25  6.08       9 2'-Deoxya… 59.47         <span style="color: #949494;">"</span>372<span style="color: #949494;">"</span>   1637… <span style="color: #949494;">"</span>C22H45N… 2'-De…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>      27  6.18       9 2,3-Bisph… 75.78         <span style="color: #949494;">"</span>456<span style="color: #949494;">"</span>   1443… <span style="color: #949494;">""</span>        DL-Ho…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>      35  6.36       9 DL-2,3-Di… 94.62         <span style="color: #949494;">"</span>334<span style="color: #949494;">"</span>   5487… <span style="color: #949494;">"</span>C18H48N… Oxami…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>      39  6.50       9 (R)-(-)-P… 94.10         <span style="color: #949494;">"</span>322<span style="color: #949494;">"</span>   61-7… <span style="color: #949494;">"</span>C18H37N… (-)-E…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>      44  6.63       9 Malonic a… 52.87         <span style="color: #949494;">"</span>252<span style="color: #949494;">"</span>   141-… <span style="color: #949494;">"</span>C13H28O… Dihyd…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>      45  6.66       9 L-Alanine… 99.11         <span style="color: #949494;">"</span>335<span style="color: #949494;">"</span>   56-4… <span style="color: #949494;">"</span>C12H31N… (R)-(…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>      51  6.75       9 L-Alanine… 99.15         <span style="color: #949494;">"</span>335<span style="color: #949494;">"</span>   56-4… <span style="color: #949494;">"</span>C12H31N… (R)-(…</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 114 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 18 more variables: MatchFactor.2 &lt;chr&gt;, DB.Id.2 &lt;chr&gt;, CAS.2 &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Formula.2 &lt;chr&gt;, Name.3 &lt;chr&gt;, MatchFactor.3 &lt;chr&gt;, DB.Id.3 &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   CAS.3 &lt;chr&gt;, Formula.3 &lt;chr&gt;, `0709_468` &lt;dbl&gt;, `0709_470` &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `0709_471` &lt;dbl&gt;, `0709_474` &lt;dbl&gt;, `0709_475` &lt;dbl&gt;, `0709_479` &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `0709_485` &lt;dbl&gt;, `0709_493` &lt;dbl&gt;, `0709_496` &lt;dbl&gt;</span></span></span></code></pre>
<p>From the table returned by <code>idList(ex)</code>, we see that
gallic acid is appearing at minute 7.81 with an AlignID number #84. Let
us have a look to its profile with the function plotProfile:</p>
<ul>
<li>Execute <code><a href="../reference/alignList.html">?alignList</a></code>, to access to the help of alignList
function with a detailed explanation of each column in an align
list.</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotProfile.html">plotProfile</a></span><span class="op">(</span><span class="va">ex</span>, <span class="fl">84</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="erah-manual_files/figure-html/plotProfile-1.png" alt="**Figure 2:** Image from `plotProfile(ex,84)`." width="700"><p class="caption">
<strong>Figure 2:</strong> Image from <code>plotProfile(ex,84)</code>.
</p>
</div>
<p>This displays Figure 2. Its spectra can be also be plotted and
compared with the reference spectra using the function plotSprectra,
which displays Figure 3:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">ex</span>, <span class="fl">84</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="erah-manual_files/figure-html/plotSpectra-1.png" alt="**Figure 3:** Image from `plotSpectra(ex,84)`." width="700"><p class="caption">
<strong>Figure 3:</strong> Image from <code>plotSpectra(ex,84)</code>.
</p>
</div>
<p>The plotSpectra function has a lot of possibilities for plotting, to
know more access to its particular help by executing
<code><a href="../reference/plotSpectra.html">?plotSpectra</a></code>. For example, eRah allows a rapid assessment
for visualizing the second hit returned in the case of compound align ID
#41 (Urea). To do so:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">ex</span>, <span class="fl">84</span>, <span class="fl">2</span>, draw.color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="erah-manual_files/figure-html/matchFactor-1.png" alt="**Figure 4:** Image from `plotSpectra(ex,84, 2, draw.color=’orange3’)`." width="700"><p class="caption">
<strong>Figure 4:</strong> Image from
<code>plotSpectra(ex,84, 2, draw.color=’orange3’)</code>.
</p>
</div>
<p>This plots Figure 4, which is a comparison of the empirical spectrum
found, with the second most similar metabolite from the database (in
this case pyridoxamine). From the figure, it is clear that eRah returned
the first hit correctly, as this spectra is more similar to gallic acid
than to pyridoxamine.</p>
</div>
</div>
<div class="section level2">
<h2 id="importing-and-customizing-mass-spectral-libraries">Importing and customizing mass spectral libraries<a class="anchor" aria-label="anchor" href="#importing-and-customizing-mass-spectral-libraries"></a>
</h2>
<div class="section level3">
<h3 id="using-the-golm-metabolome-database">Using the Golm Metabolome Database<a class="anchor" aria-label="anchor" href="#using-the-golm-metabolome-database"></a>
</h3>
<p>Users may import their own mass spectral libraries. We strongly
recommend using the Golm Metabolome Database (GMD) with eRah. To use the
GMD, first, we have to download it from its <a href="http://gmd.mpimp-golm.mpg.de/download/" class="external-link">webpage</a>, by
downloading the file ”GMD 20111121 VAR5 ALK MSP.txt” or ”GMD 20111121
MDN35 ALK MSP.txt”, depending on which type of chromatographic columns
(VAR5 or MDN35) are we using. If you are not interested in using any
retention index information, then both files can be used indistinctly.
Then, we can load the library with the function
<code><a href="../reference/importMSP.html">importMSP()</a></code>:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g.info</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">GOLM Metabolome Database</span></span>
<span><span class="st">------------------------</span></span>
<span><span class="st">Kopka, J., Schauer, N., Krueger, S., Birkemeyer, C., Usadel, B., Bergmuller, E., Dor-</span></span>
<span><span class="st">mann, P., Weckwerth, W., Gibon, Y., Stitt, M., Willmitzer, L., Fernie, A.R. and Stein-</span></span>
<span><span class="st">hauser, D. (2005) GMD.CSB.DB: the Golm Metabolome Database, Bioinformatics, 21, 1635-</span></span>
<span><span class="st">1638."</span></span>
<span></span>
<span><span class="va">golm.database</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/importGMD.html">importGMD</a></span><span class="op">(</span>filename<span class="op">=</span><span class="st">"GMD_20111121_VAR5_ALK_MSP.txt"</span>, </span>
<span>                           DB.name<span class="op">=</span><span class="st">"GMD"</span>, </span>
<span>                           DB.version<span class="op">=</span><span class="st">"GMD_20111121"</span>, </span>
<span>                           DB.info<span class="op">=</span> <span class="va">g.info</span>,type<span class="op">=</span><span class="st">"VAR5.ALK"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The library in R format can now be stored for a posterior faster loading</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">golm.database</span>, file<span class="op">=</span> <span class="st">"golmdatabase.rda"</span><span class="op">)</span></span></code></pre></div>
<p>We can substitute the default eRah database object
<code>mslib</code>, for our custom database, by the following code:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"golmdatabase.rda"</span><span class="op">)</span></span>
<span><span class="va">mslib</span> <span class="op">&lt;-</span> <span class="va">golm.database</span></span></code></pre></div>
<p>This allows executing all the functions without the need of always
setting the library parameter. If we do not replace the
<code>mslib</code> object as shown before, we have to use the new
library (in this case <code>golm.database</code>) in all the functions,
for example:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/findComp.html">findComp</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"phenol"</span>, id.database <span class="op">=</span> <span class="va">golm.database</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-in-house-libraries">Using in-house libraries<a class="anchor" aria-label="anchor" href="#using-in-house-libraries"></a>
</h3>
<p>Other MSP-formatted libraries can be also imported. The procedure is
the same as for the GMD database, with the only exception is that the
function is <code>importMSP</code> instead of <code>importGMD</code>.
Access to specific <code>importMSP</code> help in R
(<code><a href="../reference/importMSP.html">?importMSP</a></code>) for details on database MSP input format.</p>
</div>
</div>
<div class="section level2">
<h2 id="exporting-spectra-comparison-with-nist">Exporting spectra: comparison with NIST<a class="anchor" aria-label="anchor" href="#exporting-spectra-comparison-with-nist"></a>
</h2>
<p>Users may export their results to MSP format or CEF format for
comparison with NIST MS Search software (MSP), or to compare spectra
with NIST through the MassHunter workstation (CEF). Users are referred
to <code>exportMSP</code> and <code>exportCEF</code> functions help for
more details.</p>
</div>
<div class="section level2">
<h2 id="final-summary">Final Summary<a class="anchor" aria-label="anchor" href="#final-summary"></a>
</h2>
<p>To complement the given tutorial, the user may access to the
particular help for each function, as shown before. Also, and for more
details, please read the original article. Here, we show a figure
(Figure 5) with all the available functions.</p>
<div class="figure" style="text-align: center">
<img src="figures/functionSummary.png" alt="**Figure 5:** **eRah** summary of functions."><p class="caption">
<strong>Figure 5:</strong> <strong>eRah</strong> summary of functions.
</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-domingo2016" class="csl-entry">
Domingo-Almenara, Xavier, Jesus Brezmes, Maria Vinaixa, Sara Samino,
Noelia Ramirez, Marta Ramon-Krauel, Carles Lerin, et al. 2016.
<span>“eRah: A Computational Tool Integrating Spectral Deconvolution and
Alignment with Quantification and Identification of Metabolites in
GC/MS-Based Metabolomics.”</span> <em>Analytical Chemistry</em> 88 (19):
9821–29.
</div>
<div id="ref-domingo2015" class="csl-entry">
Domingo-Almenara, Xavier, Alexandre Perera, Noelia Ramirez, Nicolau
Canellas, Xavier Correig, and Jesus Brezmes. 2015. <span>“Compound
Identification in Gas Chromatography/Mass Spectrometry-Based
Metabolomics by Blind Source Separation.”</span> <em>Journal of
Chromatography A</em> 1409: 226–33.
</div>
<div id="ref-robinson2018" class="csl-entry">
Robinson, Mark. 2018. <em>Gcspikelite: Spike-in Data for GC/MS Data and
Methods Within Flagme</em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Xavier Domingo-Almenara.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
